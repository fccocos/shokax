---
title: 第五章 中央处理器
math: true
date: 2023-08-20 16:59:00
---

{% markmap 750px %}

- 中央处理器
  - CPU的功能和基本结构
    - CPU的功能
      - CPU(中央处理器)：运算器和控制器构成
      - 控制器：负责协调并控制计算机个部件执行程序的指令序列，包括取指令、分析指令和执行指令
      - 运算器：对数据进行加工
      - CPU的具体功能
        - 指令控制
          - 完成取指令、分析指令和执行指令，即程序的顺序控制。
        - 操作控制
          - 一条指令的功能往往由若干操作信号的组合来实现。
          - CPU管理并产生由内存取出的每条指令的操作信号，把各种操作信号送往相应的部件，从而控制这些部件按指令的要求进行动作。
        - 时间控制
          - 对各种操作加以时间上的控制。
          - 时间控制要为每条指令按时间顺序提供应有的控制信号
        - 数据加工
          - 对数据进行算术和逻辑运算
        - 中断处理
          - 对计算机运行过程中出现的异常情况和特殊请求进行处理
    - CPU的基本结构
      - ![中央处理组成](https://gitee.com/fangcongss/blog-pic/raw/master/img/%E4%B8%AD%E5%A4%AE%E5%A4%84%E7%90%86%E7%BB%84%E6%88%90.png)
      - 运算器
        - 运算器概念
          - 运算器接受从控制送来的命令并执行相应的动作，对数据进行加工和处理
          - 运算器是计算机对数据进行加工处理的中心
        - 运算器的组成
          - 算术逻辑单元
            - 进行算术/逻辑运算
          - 暂存寄存器
            - 暂存从主存读来的数据，该数据不能存放在通用寄存器中，否则会破坏其原有内容。
            - 暂存寄存器对应用程序员是透明的。
          - 累加寄存器
            - 一个通用寄存器，用于暂时存放AUL运算的结构信息，可以作为加法运算的一个输入端。
          - 通用寄存器组
            - AX，BX，CX，DX，SP
            - 存放操作数和各种地址信息
            - SP是堆栈指针，用于存放堆栈的栈顶指针
          - 程序状态字寄存器
            - 保留由算术逻辑运算指令或测试指令的结果而建立的各种状态信息，如溢出标志(OF)、符号标志(SF)、零标志(ZF)、进位标志(CF)
            - PSW中的这些位参与并决定微操作的形成
          - 移位器
            - 对操作数或运算结果进行移位运算
          - 计数器
            - 控制乘除运算的操作步数
      - 控制器
        - 控制器的概念
          - 控制器是整个系统的指挥中枢，在控制器的控制下，运算器、存储器和输入/输出设备等功能部件构成一个有机的整体，根据指令的要求指挥全机协调工作。
        - 控制器的功能
          - 执行指令，每条指令的执行都是由控制器发送的一组微操作实现的
        - 控制器的分类
          - 硬布线控制器
          - 微程序控制器
        - 控制器的组成
          - 程序计数器
            - 用于指出欲执行指令在主存中的存放地址。
            - CPU根据PC的内容去主存中取指令。
            - 因程序中指令通常是顺序执行的，所以PC具有自增功能
          - 指令寄存器
            - 用于保存当前正在执行的那条指令
          - 指令译码器
            - 仅对操作码字段进行译码，向控制器提供特定的操作信号
          - 存储器地址寄存器
            - 用于存放要访问的主存单元地址
          - 存储器数据寄存器
            - 用于存放向主存写入的信息或从主存中读出的信息
          - 时序系统
            - 用于产生各种时序信号，它们都由统一时钟分频得到。
          - 微操作信号发生器
            - 根据IR的内容、PSW的内容及时序信号，产生控制整个计算机系统所需要的各种控制信号，其结构有组合逻辑型和存储逻辑型两种。
        - 控制器的工作原理
          - 根据指令的操作码、指令执行的步骤（微命令序列）和条件信号来形成当前计算机各部件要用到的控制信号。
          - 计算机整机各硬件系统在这些控制信号的控制下协同运行，产生预期的执行结果。
    
  - 指令执行过程
    - 指令周期
      - CPU从主存中取出并执行一条指令的时间称为指令周期，不同指令的指令周期可能不同
      - 指令周期常用若干机器周期，一个机器周期又包含若干时钟周期。
      - 每条指令周期内的机器周期可以不等，每个机器周期内的节拍数也可以不相等
      - 对于无条件转移指令JMP X，在执行期间不需要访问主存，只包含取指阶段和执行阶段
      - 对于间接寻址的指令，为了取得操作数，需要访问一次主存，取出有效地址，然后访问主存，取出操作数，所以还需包括间址周期。
      - 当CPU采用中断方式实现主机和I/O设备的信息交换时，CPU在每条指令执行结束前，都要发送中断查询信号，若有中断请求，则CPU进入中断响应阶段，又称中断周期。
      - 一个完整的指令周期包含：取址、间址、执行和中断
      - 4个工作周期都有CPU访存操作
        - 取指周期为了取指令
        - 间址周期为了取有效地址
        - 执行周期为了取操作数
        - 中断周期为了保存程序断点
        - 在CPU内部设置4个标志触发器来区别不同的工作周期
          - FE触发器$\to$取址周期
          - IND触发器$\to$间址周期
          - EX触发器$\to$执行周期
          - INT触发器$\to$中断周期
    - 指令周期的数据流
      - 数据流：根据指令要求依次访问的数据序列
      - 在指令执行的不同阶段，要求依次访问的数据序列是不同的
      - 对于不同的指令，它们的数据流往往也是不同的
      - 取指周期
        - 取指周期的任务
          - 根据PC中的内容从主存中取出代码并存放在IR中
          - PC中存放的是指令的地址，根据此地址从内存单元中取出的是指令，并存放在指令寄存器IR种，取指令的同时，PC加1
        - 取址周期的数据流向
          - $PC\underline{(1)}MAR\underline{(2)}$地址总线$\underline{(3)}$主存
          - CU发出读命令$\underline{(4)}$控制总线$\underline{(5)}$主存
          - 主存$\underline{(6)}$数据总线$\underline{(7)}$MDR$\underline{(8)}$IR(存放指令)
          - CU发出控制信号$\underline{(9)}$PC内容加1
          - ![取指周期的数据流](https://gitee.com/fangcongss/blog-pic/raw/master/img/%E5%8F%96%E6%8C%87%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81.png)
      - 间址周期
        - 间址周期的任务
          - 取操作数有效地址
        - 一次间址数据流
          - 将指令中的地址码送到MAR并送至地址总线，此后CU向存储器发送读命令，以获取有效地址并送至MDR
        - 间址周期的数据流向
          - Ad(IR)(或MDR)$\underline{(1)}MAR\underline{(2)}$地址总线$\underline{(3)}$主存，Ad(IR)表示取出IR中存放的指令字的地址字段
          - CU发送读命令$\underline{(4)}$控制总心啊$\underline{(5)}$主存
          - 主存$\underline{(6)}$数据总线$\underline{(7)}$MDR(存放有效地址)
          - ![一次间址周期的数据流](https://gitee.com/fangcongss/blog-pic/raw/master/img/%E4%B8%80%E6%AC%A1%E9%97%B4%E5%9D%80%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81.png)
      - 执行周期
        - 执行周期的任务
          - 取操作数，并根据IR中的指令字的操作码通过ALU操作产生执行结果
          - 不同指令的执行周期操作不同，因此没有统一的数据流向
      - 中断周期
        - 中断周期的任务
          - 处理中断请求
        - 中断周期的数据流向
          - CU控制将SP减1，SP$\underline{(1)}MAR\underline{(2)}$地址总线$\underline{(3)}$主存
          - CU发出写命令$\underline{(4)}$控制总线$\underline{(5)}$主存
          - $PC\underline{(6)}MDR\underline{(7)}$数据总线$\underline{(8)}$主存（程序断点存入主存）
          - CU（中断服务程序的入口地址）$\underline{(9)}PC$
          - ![中断周期的数据流](https://gitee.com/fangcongss/blog-pic/raw/master/img/%E4%B8%AD%E6%96%AD%E5%91%A8%E6%9C%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81.png)
    - 指令执行方案
      - 单指令周期
        - 对所有指令都选用相同的执行时间来完成
        - 每条指令都在一个时钟周期内完成，指令之间串行执行，即下一条指令只能在前一条指令执行结束后才能启动。
        - 时钟周期取决于执行时间最长的指令的执行时间
      - 多指令周期
        - 对不同类型的指令选用不同的执行步骤
        - 指令之间串行执行，即下条指令只能在前一指令执行后才能启动
        - 可选用不同个数的时钟周期来完成不同指令的执行过程，指令需要几个周期就为其分配几个周期，不再要求所有指令占用相同的执行时间
      - 流水线方案
        - 指令之间可以并行执行的方案
        - 其追求的目标是力争在每个时钟脉冲周期完成一条指令的执行过程
        - 这种方案通过在每个时间周期启动一条指令，尽量让多条指令同时运行，但各自处在不同的执行步骤中
    
  - 数据通路的功能和基本结构
    - 数据通路的功能
      - 数据通路：数据在功能部件之间传送的路径，包括数据通路上流经的部件
      - 数据通路描述了信息从什么地方开始，中间经过哪个寄存器或多路开关，最后传送到哪个寄存器，这些都需要加以控制
      - 数据通路由控制部件控制，控制部件根据每条指令功能的不同生成对数据通路的控制信号
      - 数据通路的功能是实现CPU内部的运算器与寄存器之间的数据交换。
    - 数据通路的基本结构
      - CPU内部单总线方式
        - 将所有寄存器的输入端和输出端都连接到一条公共通路上，这种结构比较简单，但数据传输在较多的冲突现象，性能较低
        - 连接各部件的总线只有一条时，称为单总线结构
        - CPU中有两条或更多的总线时，构成双总线结构或多总线结构
      - CPU内部多总线方式
        - 将所有寄存器的输入端和输出端都连接到多条公共通路上，相比之下单总线中一个时钟内只允许传一个数据，因而指令执行效率很低，因此采用多总线方式，同时在多个总线上传送不同的数据，提高效率
      - 专用数据通路方式
        - 根据指令执行过程中的数据和地址的流动方向安排连接线路，避免使用共享的总线，性能较高，但硬件量大
      - ![CPU内部总线的数据通路和信号控制](https://gitee.com/fangcongss/blog-pic/raw/master/img/CPU%E5%86%85%E9%83%A8%E6%80%BB%E7%BA%BF%E7%9A%84%E6%95%B0%E6%8D%AE%E9%80%9A%E8%B7%AF%E5%92%8C%E4%BF%A1%E5%8F%B7%E6%8E%A7%E5%88%B6.png)
    - 寄存器之间的数据传送
      - 通过CPU内部总线完成
    - 主存与CPU之间的数据传送
      - 借助CPU内部总线完成
    - 执行算术或逻辑运算
    
  - 控制器的功能和工作原理
    - 控制器的结构和功能
    
      - ![计算机硬件系统和控制器部件的组成](https://gitee.com/fangcongss/blog-pic/raw/master/img/计算机硬件系统和控制器部件的组成.png)
      - 连接关系说明：
        - 运算器部件通过数据总线与内部存储器、输入设备和输出设备传送数据
        - 输入设备和输出设备通过接口电路与总线相连接
        - 内存储器、输入设备和输出设备从地址总线接受地址信息，从控制总线得到控制信号，通过数据总线与其他部件传送数据
        - 控制部件从数据总线接受指令信息，从运算器部件接收指令转移地址，送出指令地址到地址总线，还要向系统中的部件提供它们运行所需要的控制信号
      - 控制器的主要功能
        - 从主存中取出一条指令，并指出下一条指令在主存中的位置
        - 对指令进行译码或测试，产生相应的操作控制信号，以便启动规定的动作
        - 指挥并控制CPU、主存、输入河输出设备之间的数据流动方向
    
    - 硬布线控制器
    
      - 基本原理
    
        - 根据指令的要求、当前的时序及外部或内部的状态，按时间的顺序发送一系列微操作控制信号。
    
      - 硬布线控制单元
    
        - 指令的操作码是决定控制单元发出不同操作命令（控制信号）的关键
    
        - 为了简化控制单元（CU）的逻辑，将指令的操作码译码和节拍发生器从CU分离出来，便可得到简化的控制单元图
    
          - ![带指令译码器和节拍输入的控制单元图](https://gitee.com/fangcongss/blog-pic/raw/master/img/%E5%B8%A6%E6%8C%87%E4%BB%A4%E8%AF%91%E7%A0%81%E5%99%A8%E5%92%8C%E8%8A%82%E6%8B%8D%E8%BE%93%E5%85%A5%E7%9A%84%E6%8E%A7%E5%88%B6%E5%8D%95%E5%85%83%E5%9B%BE.png)
          - CU的输入信号来源
            - 经指令译码器译码产生的指令信息
              - 现行指令的操作码决定了不同指令在执行周期所需完成的不同操作，因此指令的操作码字段是控制单元的输入信号，它与时钟配合产生不同的控制信号
            - 时序系统产生的机器周期信号和节拍信号
              - 为了使控制单元按一定的先后顺序、一定的节奏发出各个控制信号，控制单元必须受时钟控制，即一个时钟脉冲使控制单元发送一个操作命令，或发送一组需要同时执行的操作命令
            - 来自执行单元的反馈信息即标志
              - 控制单元有时需依赖CPU当前所处的状态产生控制信号，控制单元要根据上条指令的结果是否为负来产生不同的控制信号
            - 节拍发生器产生各机器周期中的节拍信号，使不同的微操作命令$C_i$(控制信号)按时间的先后发出。
            - 个别指令的操作不仅受操作码控制，还受状态标志控制，因此CU的输入来自操作码译码电路ID、节拍发生器及状态标志，其输出到CPU内部或外部控制总线上
    
        - 硬布线控制器的时序系统及微操作
    
          - 时钟周期
    
            - 用时钟信号控制节拍发生器，可以产生节拍，每个节拍的宽度正好对应一个时钟周期。
            - 在每个节拍内机器可完成一个或几个需同时执行的操作
    
          - 机器周期
    
            - 机器周期可以视为所有指令执行过程中的一个基准时间。
            - 不同指令的操作不同，指令周期也不同
            - 访问一次存储器的时间是固定的，因此通常以存取周期作为基准时间，即内存中读取一个指令字的最短时间作为机器周期
            - 在存储字长等于指令字长的前提下，取指周期也可视为机器周期
            - 在一个机器周期里可完成若干微操作，每个微操作都需一定的时间，可用时钟信号来控制产生每个微操作命令
    
          - 指令周期
    
          - 微操作命令分析
    
            - 控制单元具有发生各种操作命令（控制信号）序列的功能
            - 这些命令与指令有关，而且必须按一定次序发生，才能使机器有序地工作
    
          - 一条指令分为3个工作周期：取指周期、间址周期和执行周期
    
            - 取指周期的微操作命令。
              - (PC)->MAR          现行指令地址->MAR
              - 1->R                     命令存储器读
              - M(MAR)->MDR  现行指令从存储器中读至MDR
              - (MDR)->IR          现行指令->IR
              - OP(IR)->CU        指令的操作码->CU译码
              - (PC)+1->PC        形成下一条指令的地址
            - 间址周期的微操作命令。间址周期完成取操作数地址的任务。
              - $Ad(IR)\to MAR$       将指令字中的地址码（形式地址）$\to$MAR
              - 1$\to$R                      命令存储器读
              - $M(MAR)\to MDR$  将有效地址从存储器读至MDR
    
            - 执行周期的微操作命令。
    
              - 非访存指令
                - $CLA$          清ACC   $0\to ACC$
                - $COM$        取反        $\overline{ACC}\to ACC$
                - $SHR$         算术右移  $L(ACC)\to R(ACC),ACC_0\to ACC_0$
                - $CSL$         循环左移   $R(ACC)\to L(ACC),ACC_0\to ACC_n$
                - $STP$         停机指令   $0\to G$    
              - 访存指令
                - $ADD\ X$   加法指令
                - $Ad(IR)\to MAR.1\to R$
                - $M(MAR)\to MDR$
                - $(ACC)+(MDR)\to ACC$
                - $STA\ X$    存数指令
                - $Ad(IR)\to MAR,1\to M$
                - $(ACC)\to MDR$
                - $(MDR)\to M(MAR)$
                - $LDA\ X$    取数指令
                - $Ad(IR)\to MAR,1\to R$
                - $M(MAR)\to MDR$
                - $(MDR)\to ACC$
    
              -  转移指令
                - $JMP\ X$   无条件转移       $Ad(IR)\to PC$
                - $BAN\ X$   条件转移           $A0\cdot Ad(IR)+\overline{A_0}\cdot (PC)\to PC$
    
        - CPU的控制方式
    
          - 控制单元控制一条指令执行的过程，实质上是依次执行一个确定的微操作序列的过程。
          - 同步控制方式
            - 所谓同步控制方式，是指系统有一个统一的时钟，所有的控制信号均来自这个统一的时钟信号。
            - 通常以最长的微操作序列和最烦琐的微操作作为标准，采取完全统一的、具有相同时间间隔和相同数目的节拍作为机器周期来运行不同的指令
          - 异步控制方式
            - 异步控制方式不存在基准时标信号，各部件按自身固有的速度工作，通过应答方式进行联络
            - 异步控制方式的优点是运行速度快，缺点是控制电路比较复杂
          - 联合控制方式
            - 联合控制方式是介于同步、异步之间的一种折中
            - 这种方式对各种不同的指令的微操作实行大部分采用同步控制、小部分采用异步控制的办法
    
      - 硬布线控制单元设计步骤
    
        - 列出微操作命令的操作时间表
        - 进行微操作信号综合
        - 画出微操作命令的逻辑图
    
    - 微程序控制器
    
      - 微程序控制器采用存储逻辑实现，也就是把微操作信号代码化，使每条机器指令转化为一段微程序并存入一个专门的存储器（控制存储器）中，微操作控制信号由微指令产生。
      - 微程序控制的基本概念
        - 微程序设计思想
          - 将每条机器指令编写成一个微程序，每个微程序包含若干微指令，每条微指令对应一个或几个微操作命令。
          - 这些微程序可以存放到一个控制存储器中，用寻址用户程序机器指令的办法来寻址每个微程序中的微指令。
          - 微程序设计技术涉及的基本术语
            - 微命令与微操作
            - 微指令与微周期
            - 主存储器与控制存储器
            - 程序与微程序
      - 微程序控制器组成和工作过程
        - 微程序控制器的基本组成
          - 控制存储器
          - 微指令寄存器
          - 微地址形成部件
          - 微地址寄存器
        - 微程序控制的工作过程
          - 执行取微指令公共操作
          - 由机器指令的操作码字段通过微地址形成部件产生该机器指令所对应的微程序的入口地址，并送入CMAR
          - 执行完对应于一条机器指令的一个微程序后，又回到取指微程序的入口地址。继续第一步，以完成取下一条机器指令的公共操作
        - 微程序和机器指令
      - 微指令的编码方式
        - 直接编码（直接控制）方式
        - 字段直接编码方式
        - 字段间接编码方式
      - 微指令的地址形成方式
        - 直接由微指令的下地址字段指出
        - 根据机器指令的操作码形成
      - 微指令的格式
        - 水平型微指令
        - 垂直型微指令
        - 混合型微指令
        - 水平型和垂直型微指令的比较
      - 微程序控制单元的设计步骤
      - 动态微程序设计和毫微程序设计
        - 动态微程序设计
        - 毫微程序设计
      - 硬布线和微程序控制器的特点
    
  - 异常和中断机制
    - 异常和中断的基本概念
    - 异常和中断的分类
    - 异常和中断响应过程
    
  - 指令流水线
    - 指令流水线的基本概念
    - 流水线的基本实现
    - 流水线的冒险与处理
    - 流水线的性能指标
    - 高级流水线技术
    
  - 多处理器的基本概念
    - SISD、SIMD、MIMD的基本概念
    - 硬件多线程的基本概念
    - 多核处理器的基本概念
    - 共享内存多处理器的基本概念

{% endmarkmap %}