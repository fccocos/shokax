---
title: 第四章 网络层
tag:
  - 计算机网络
  - - 计算机网络
    - 网络层
valine: true
math: true
sticky: true
abbrlink: c8c4683d
date: 2023-08-21 05:34:09
---

{% markmap 750px %}

- 网络层
  - 网络层功能：向上提供简单灵活的、无连接的、尽最大努力交付的数据服务
    - 异构网络互连
      - 网络互连：指将两个以上的计算机网络，通过一定的方法，用一些中间设备连接起来，以构成更大的网络系统。通常指用路由器进行网络互连和路由选择。
      - 中继系统
        - 物理层中继系统：转发器、集线器
        - 链路层中继系统：网桥或交换机
        - 网络层中继系统：路由器
        - 网络层以上的中继系统：网关
      - 物理层和数据链路层的中继系统只是把网络扩大了，仍属一个网络。
      - 虚拟网络互连（逻辑网络互连）：互连起来的各种物理网络的异构性本来时客观存在的，但是通过IP协议就可以使这些性能各异的网络在网络层上看起来好像是一个统一的网络。
      - IP网络：使用IP协议的虚拟网络互连网络
      - 使用IP网络的好处：当IP网上的主机进行通信时，就好像子啊一个单个网络上通信一样，而看不见互连的各网络的具体异构细节
    - 路由与转发
      - 路由器的两个功能
        - 路由选择：根据特定的路由协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断地更新和维护路由表
        - 分组转发：处理通过路由器的数据流，关键操作是转发查询、转发及相关的队列管理和任务调度
    - SDN的基本概念
      - 数据平面：实现转发功能
      - 控制平面：实现路由选择功能
      - 软件定义网络（SDN）：采用集中式的控制平面和分布式的数据平面，两个平面相互分离，控制平面利用控制—数据接口对数据平面上的路由器进行集中式控制，方便软件来控制网络
      - 北向接口：编程接口
      - 南向接口：SDN控制器和转发设备建立双向会话的接口
      - 东西向接口：SDN控制器集群内部控制器之间的通信接口
      - SDN的优点：
        - 全局集中式控制和分布式高速转发，既有利于控制平面的全局优化，又有利于高性能的网络转发
        - 灵活可编程与性能的平衡，控制和转发功能分离后，使得网络可以由专有的自动化工具以编程方式配置
        - 降低成本，控制和数据平台分离后，尤其是在使用开发的接口协议后，就实现了网络设别的制造与功能软件的开发相分离，从而有效降低了成本
      - SDN的缺点
        - 安全风险，集中管理容易受到攻击，如果崩溃，整个网络会收到影响
        - 瓶颈问题，原本分布式的控制平面集中化后，随着网络规模扩大，控制器可能成为
    - 拥塞控制
      - 拥塞：在子网中，由于出现过量的分组而引起的网络性能下降
      - 判断网络拥塞的方法
        - 观察网络的吞吐量语网络负载的关系
          - 如果负载增大，而网络的吞吐量明显小于正常的吞吐量，则“轻度”拥塞
          - 如果吞吐量随着负载的增大而降低，可能进入了拥塞
          - 负载增大，而吞吐量下降到零，则网络进入死锁状态
      - 拥塞控制：如何获取发生拥塞的信息，从而利用这些信息进行控制，以避免由于拥塞出现分组丢失，以及严重拥塞而产生网络死锁的现象。
      - 拥塞控制的作用：确保子网能够承载所达到的流量。单一地增加资源并能解决拥塞
      - 流量控制和拥塞控制的区别
        - 流量控制往往是指在发送端和接收端和之间的点对点通信量的控制。流量控制所要做的是抑制发送端发送数据的速率，以便于接收端来得及接收。
        - 拥塞控制必须确保通信子网能够传送待传送的数据，是一个全局性的问题，涉及网络中所有的主机、路由器及导致网络传输能力下降的所有因素。
      - 拥塞控制的两种方法
        - 开环控制
        - 闭环控制
    
  - 路由算法
    - 静态路由与动态路由
      - 静态路由（非自适应路由算法）：由网络管理员手动配置路由信息
      - 动态路由算法（自适应路由算法）：按照一定的算法，在一定时间内自行地进行路由信息的配置和更新
    - 距离—向量路由算法（定期将转发表传送给与之直接相邻的结点）
      - 路由选择表
        - 每条路径的目的地
        - 路径的代价
      - 所有的结点都监听从其他结点传来的路由选择更新信息，并在以下情况下更新路由选择表：
        - 被通知一条新的路由
        - 发来的路由信息中有一条到达某个目的地代价更小的路由
      - 距离—向量路由算法的实质：迭代计算一条路由中的站段数或延迟事件，从而得到到达一个目标的最短（最小代价）通路。
      - 常见距离—向量路由算法：RIP算法，采用“跳数”作为距离的度量
    - 链路状态路由算法（结点要有完整的网络拓扑信息）
      - 主动测试所有邻接结点的状态
      - 定期地将链路状态传播给其他结点信息
      - 链路状态路由算法的执行过程
        - 在一个链路状态路由选择中，一个结点检查所有直接链路的状态，并将所得的状态信息发送给网上的所有其他结点，而不是仅送给那些直接相连的结点。
        - 每个结点都用这种方式从网上其他的结点接收包含直接链路转态的路由选择信息
      - 链路状态路由算法的三个特征
        - 向本自治系统中所有路由器发送信息（洪泛法）
        - 发送的信息是与路由器相邻的素有路由器的链路状态
        - 只有当链路状态发生变化时，路由器才向所有路由器发送此信息
      - 链路状态路由算法的优点
        - 每个路由结点都使用同样的原始状态数据独立地计算路径，而不依赖中间结点的计算
        - 链路状态报文不加改变地传播，因此采用该算法易于查找故障
        - 当一个结点从所有其他结点接收到报文时，他可以在本地立即计算正确的通路，保证一步汇聚
        - 由于链路状态报文仅运载来自单个结点关于直接链路的信息，器大小与网络中的路由结点数目无关，因此链路状态算法比距离—向量算法有更好的规模可伸展性
      - 链路转态路由算法和距离—向量路由算法的比较
        - 在距离—向量路由算法中，每个结点仅与它的直接邻居交谈，它为它的邻居提供从自己到网络中所有其他结点的最低费用估计。
        - 在链路状态路由算法中，每个结点通过广播的方式与所有其他结点交谈，但它仅告诉它们与它直接相连的链路的费用
        - 相较之下，距离—向量路由算法有可能遇到路由环路等问题
    - 层次路由
      - 内部网关协议（IGP）：一个自治系统内部使用的路由选择协议。又叫域内路由选择，具体的协议有RIP和OSPF等
      - 外部网关协议（EGP）：自治系统之间使用的路由选择协议。又叫域间路由选择。在不同自治系统的路由器之间交换路由信息，并负责为分组在不同自治系统之间选择最优的路径。具体的协议有BGP
    
  - IPv4
    - IPv4分组
      - IPv4分组格式（首部和数据分组）
        - 版本(4b)
        - 首部长度(4b)
        - 总长度(16b)：
        - 标识(16b)
        - 标志(3b)
        - 片偏移(13b)
        - 生存时间TTL(8b)
        - 协议(8b)
        - 首部校验和(16b)
        - 源地址字段(32b)
        - 目的地址字段(32b)
      - IP数据报分片
      
    - IPv4地址和NAT
      - IPv4地址：网络号+主机号
        - 分类IP地址
          - A类：1～127
          - B类：128～191
          - C类：192～223
          - D类：224～239
          - E类：240～255
        - 特殊用途的IP地址
          - 主机号全为0表示本网络本身
          - 主机号全为1表示本网络的广播地址，又称直接广播地址
          - 127.x.x.x保留为回环自检地址
          - 32位全为0，表示本网络上的本主机
          - 32位全为1，表示整个TCP/IP网络的广播地址，又称受限广播地址。实际使用时，由于路由器对广播域的隔离，255.255.255.255等效为本网络的广播地址
        - IP地址的特点
          - 每个IP地址都由网络号和主机号组成
          - IP地址是标志一台主机（或路由器）和一条链路接口
          - 用转发器或桥接器连接的若干LAN仍然是同一个网络（同一个广播域），因此该LAN中所有主机的IP地址的网络号必须相同，但主机号必须不同。
          - 在IP地址中，所有分配到网络号的网络（无论是LAN还是WAN）都是平等的
          - 在同一个局域网上的主机或路由器的IP地址中的网络号必须是一样的
      - 网络地址转换（NAT）：通过将专用网络地址转换为公用地址，从而对外隐藏内部管理的IP地址。
        - NAT的好处：
          - 整个专用网只需要一个全球IP地址就可以与因特网连通，由于专用本地IP地址是可重复使用的，所以NAT大大节省了IP地址的消耗
          - 隐藏了专用网内部结构，从而降低了内部网络受到攻击的风险
        - 私有IP地址
          - 只用于LAN，不用于WAN
          - 私有IP地址不能直接用于Internet，必须通过网关利用NAT把私有地址IP转换为Internet中合法的全球IP地址后才能用于Internet
        - 私有IP地址网络段
          - A类：1个A类网段——10.0.0.0~10.255.255.255
          - B类：16个B类网段——172.16.0.0~172.31.255.255
          - C类：256个C类网段——192.168.0.0～192.168.255.255
        - 在因特网中的所有路由器，对目的地址为私有地址的数据报一律不进行转发
        - 采用私有IP地址的互联网成为专用网或本地网络
        - 私有IP也称为可重用地址
        - NAT原理
          - 使用NAT时需要在专用网连接到因特网的路由器上安装NAT软件，NAT路由器至少有一个有效的外部全球IP地址。
          - 使用本地地址的主机和外部通信时，NAT路由器使用NAT转换表进行本地IP地址和全球IP地址的转换。
          - NAT转换表中存放着{本地IP地址：端口}到{全球IP地址:端口}的映射。
          - 通过这种映射方式，可让多个私有IP地址映射到一个全球IP地址
      
    - 子网划分与子网掩码、CIDR
      - 子网划分
        - 基本思路
          - 子网划分纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络
          - 从主机号借用若干比特作为子网号，当然主机号也就相应减少了相同的比特。三级IP地址的机构：IP地址={<网络号>,<子网号>,<主机号>}
          - 凡事从其他网络发送到本单位某台主机的IP数据报，仍然是根据IP数据报的目的网络号，先找到连接到本单位网络上的路由器。然后该路由器在收到IP数据包后，按目的网络号和子网号找到目的子网。最后把IP数据报直接交付给目的主机。
        - 从IP地址本身或IP数据报的首部是无法知道源主句或目的主机的网络是否进行了子网划分。
        - RFC 90规定，子网号不能全为1或0
        - 子网中主机号全为0的地址为子网的网络号，主机号全为1的地址为子网的广播地址
      - 子网掩码
      - 无分类编址CIDR
      - 网络层转发分组的过程
      
    - ARP、DHCP与ICMP
      - IP地址与硬件地址
        - IP和MAC的区别与联系
        - 寻址过程
        - 提高路由选择效率
          - 在IP层抽象的互联网上只能看到IP数据报
          - 虽然在IP数据报首部中有源IP地址，但路由器只根据目的IP地址进行转发
          - 在局域网的链路层，只能看见MAC帧。
          - IP层抽象的互联网屏蔽了下层复杂的细节。
        
      - 地址解析协议ARP
      
        - ARP在链路层的用作原理
          - 在实际网络的链路上传送数据帧时，最终必须使用硬件地址
          - 用地址解析协议来完成IP地址到MAC地址的映射
          - ARP表：在ARP高速缓存中存放本局域网上各台主机和路由器的IP地址到MAC地址的映射表。
          - 使用ARP来用来维护ARP表
        - ARP在网络层的工作原理
          - 主机A欲向本局域网上的某台主机B发送IP数据包时，先在其ARP高速缓存中查看有无主机B的IP地址
          - 如果有，就可查出其对应的硬件地址，再将此硬件地址写入MAC帧，然后通过局域网将该MAC帧发送此硬件地址
          - 如果没有，那么就通过使用目的MAC地址为FFFF—FF-FF-FF-FF的帧来封装并广播ARP请求分组（广播发送），使同一个局域网里的所有主机都收到此ARP请求
          - 主机B收到该ARP请求后，向主机A发出ARP响应分组（单播发送），分组中包含主机B的IP与MAC地址的映射关系，主机A收到ARP响应分组后将此映射写入ARP缓存，然后按查询到的硬件地址发送MAC帧。
          - ARP由于“看到了”IP地址，所以它工作在网络层，而NAT路由器由于“看到了”端口，所以它工作在传输层。
        - 注意：
          - ARP用于解决一个局域网上的主机或路由器的IP地址和硬件地址的映射问题。
          - 如果所要找的主机和源主机不在同一个局域网上，那么就要通过ARP找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。
          - 剩下的工作就由下一个网络来做，尽管ARP请求分组是广播发送的，但ARP响应分组是不同的单播，即从一个源地址发送到一个目的地址。
        - 使用ARP的4种典型情况
          - ![ARP使用情况](https://gitee.com/fangcongss/blog-pic/raw/master/img/ARP%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png)
          - 发送方是主机($H_1$)，要把IP数据报发送到本网络上的另一台主机($H_2$)。这时$H_1$在网1用ARP找到目的主机$H_2$的硬件地址。$\to$(1)
          - 发送方是主机($H_1$)，要把IP数据报发送到另一个网络上的一台主机($H_3$)。这时$H_1$用ARP找到与网1连接的路由器$R_1$的硬件地址，剩下的工作由$R_1$来完成。$\to$(3)
          - 发送方是路由器($R_1$)，要把IP数据报转发到与$R_1$连接的网络(网2)上的一台主机($H_3$)。这时$R_1$在网2用ARP找到目的主机$H_3$的硬件地址。$\to$(3)
          - 发送方是路由器($R_1$)，要把IP数据报转发到网3上的一台主机($H_4$)。这时 $R_1$在网2用ARP找到与网2连接的路由器$R_2$的硬件地址，剩下的工作由$R_2$来完成。$\to$(4)
      
      - 动态主机配置协议DHCP
      
        - 给主机动态地分配IP地址，它提供了即插即用的联网机制，这种机制允许一台计算机加入新的网络和获取IP地址而不用手工参与
        - DHCP是应用层协议，它基于UDP的
        - DHCP工作原理
          - 私用客户/服务器模式。需要IP地址的主机在启动时就向DHCP服务器广播发送发现报文，这时该主机就成为DHCP客户。本地网络上所有主机都能收到此广播报文，但只有DHCP服务器才回答此广播报文。
          - DHCP服务器先在其数据库中查找该计算机的配置信息
          - 如果找到，则返回找到的信息
          - 如果找不到，则从服务器的IP地址池中取一个地址分配给该计算机
          - DHCP服务器的回答报文成为提供报文。
        - DHCP服务器和DHCP客户端的交换过程
          - DHCP客户端广播"DHCP发现"消息，试图找到网络的DHCP服务器，以便从DHCP服务器获得一个IP地址。源地址为0.0.0.0，目的地址为255.255.255.255。
          - DHCP服务器收到"DHCP发现"消息后，广播"DHCP提供"消息，其中包括提供给DHCP客户机的IP地址。源地址为DHCP服务器地址，目的地址为255.255.255.255。
          - DHCP服务器广播“DHCP提供”消息，如果接收该IP地址，那么就广播“DHCP请求”消息向DHCP服务器请求提供IP地址。源地址为0.0.0.0，目的地址为255.255.255.255。
          - DHCP服务器广播"DHCP确认"消息，将IP地址分配给DHCP客户机。源地址为0.0.0.0，目的地址为255.255.255.255。
        - DHCP允许网络上配置多台DHCP服务器，当DHCP客户机发送“DHCP发现”消息时，有可能收到多个消息。这时，DHCP客户机只会挑选其中的一个，通常台挑选最先到达的
        - DHCP服务器分配给DHCP客户的IP地址是临时的，因此DHCP客户只能在一段有限的时间内使用这个分配到的IP地址。DHCP称这段时间为租用期。租用期的数值应由DHCP服务器自己决定，DHCP客户也可在自己发送的报文中提出对租用期的要求。
        - DHCP的客户端和服务器端需要通过广播方式来进行交互，原因是在DHCP执行初期，客户端不知道服务器端的IP地址，而在执行中间，客户端并未被分配IP地址，从而导致两者之间的通信必须采用广播的方式。采用UDP而不采用TCP的原因也很明显：TCP需要建立连接，如果连对方的IP地址都不知道，那么更不可能通过双方的套接字建立连接。
        - DHCP是应用层协议，因为它是通过客户/服务器模式工作的，DHCP客户端向DHCP服务器请求服务，而其他层次的协议是没有这两种工作方式的。
      
      - 网际控制报文协议ICMP
      
        - 使用ICMP来让主机或路由器报告差错和异常情况
      
        - ICMP报文作为IP层数据报的数据，加上数据报的首部，组成IP数据报发送出去。
      
        - ICMP是网络层协议
      
        - ICMP两种报文
      
          - ICMP差错报文
            - ICMP差错报文用于目标主机或到目标主机路径上的路由器向源主机报告差错和异常情况
            - 5种ICMP差错报文
              - 终点不可达
              - 源点抑制
              - 时间超时
              - 时间超时
              - 改变路由
            - 不发送ICMP差错报文的情况
              - 对ICMP差错报文不在发送ICMP差错报文
              - 对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报文
              - 对具有组播地址的数据报都不发送ICMP差错报文
              - 对具有特殊地址（如127.0.0.0或0.0.0.0）的数据报不发送ICMP差错报文
          - ICMP询问报文
            - 4种ICMP询问报文
              - 回送请求和回答报文
              - 瞬间戳请求和回答报文
              - 地址掩码请求和回答报文
              - 路由器询问和通告报文
          - ICMP常见应用
            - 分组网间探测PING（用来测试两台主机之间的连通性）
              - PING使用了ICMP回送请求和回答报文
            - Traceroute(用来跟踪分组经过的路由)
            - Tranceroute使用了ICMP时间超过报文
          - PING工作在应用层，它直接使用网络层的ICMP，而未使用传输的TCP或UDP
          - Traceroute工作在网络层
      
          
    
  - IPv6
    - IPv6的主要特点
    - IPv6地址
    
  - 路由协议
    - 自治系统：单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由
    - 域内路由与域间路由
      - 域内路由选择：AS内部的路由选择
      - 域间路由选择：AS之间的路由选择
      - 内部网关协议IGP：RIP或OSPF
      - 外部网关协议EGP：BGP-4
    
    - 路由信息协议（RIP）
      - RIP是一种分布式的基于距离向量的路由选择协议，其最大优点就是简单
      - RIP规定
        - 网络中的每个路由器都要维护它自身到其他每个目的网络的距离记录（因此这是一组距离，成为距离向量）
        - 距离也称跳数（Hip Count），规定从一个路由器到直接连接网络的距离（跳数）为1。而每经过一个路由器，距离（跳数）加1。
        - RIP认为好的路由就是它通过的路由器的数目少，即优先选择跳数少的路径
        - RIP允许一条路径最多包含15个路由器（即最多允许15跳）。因此距离等于16时，表示网络不可达。可见RIP只适用于小型互联网。距离向量路由可能会出现环路的情况，规定路径上的最高跳数的目的是为了防止数据报不断循环在环路上，减少网络拥塞的可能性
        - RIP默认在任意两个使用RIP的路由器之间每30s广播一次RIP路由更新信息，以便自动建立并维护路由表（动态维护）
        - 在RIP中不支持子网掩码的RIP广播，所以RIP中每个网络的子网掩码必须相同。但在新的RIP2中，支持变长的子网掩码和CIDR。
      - RIP的特点（注意与OSPF的特点比较）
        - 仅和相邻路由器交换信息
        - 路由器交换的信息是当前路由器所知道的全部信息，即自己的路由表
        - 按固定的时间间隔交换路由信息
      - 距离向量算法
        - 路由表项的三个关键数据：<目的网络N，距离d，下一跳路由器地址X>
        - 步骤
          - 在地址为X的相邻路由器发来的RIP报文，先修改此报文的所有项目：把“下一跳”字段中的地址改为X，并把所有“距离”字段的值加1
          - 对修改后的RIP报文中的每个项目，执行如下步骤：
            - 当原来的路由表中没有目的网络N时，把该项目添加到路由表中
            - 当原来的路由表中没有目的网络N，且下一跳路由器的地址是X时，用都到的项目替换原来路由表中的项目
            - 当原来的路由表中有目的网络N，且下一跳路由器的地址不是X时，如果收到的项目中的距离d小于路由表中的距离，那么就用收到的项目替换原路由表中的项目；否则什么都不做。
          - 如果180s（RIP默认超时时间为180s）还没有收到相邻路由器的更新路由表，那么把此相邻路由器记为不可达路由器，即把距离设置为16（距离为16表示不可达）
          - 返回
        - 优点
          - 实现简单
          - 开销小
          - 收敛过程快
        - 缺点
          - RIP限制了网络的规模
          - 路由器之间交换的是路由器中的完整路由表，因此网络规模越大，开销越大
          - 网络故障时，会出现慢收敛现象（即需要较长的时间才能将此信息传送到所有路由器），俗称“坏消息传得慢”，使得更新过程的收敛时间长。
        - RIP时应用层协议，使用UDP传输数据
    
    - 开放最短路径优先（OSPF）协议
    
      - OSPF是使用分布式链路状态路由算法的典型代表，也是内部网关协议的一种
      - OSPF和RIP比较4个主要区别
        - OSPF向本自治系统中的所有路由器发送信息，这里使用的方法是洪泛法。而RIP仅向自己相邻的几个路由器发送信息
        - 发送的信息是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。“链路状态”说明本路由器和那些路由器相邻以及该链路的“度量”（或代价）。而在RIP中，发送的信息是本路由所知道的全部信息，即整个路由表的信息。
        - OSPF是网络层协议，它不使用UDP或TCP，而直接用IP数据报传送（其IP数据报首部的协议字段为98）。而RIP是应用层协议，它的传输层使用UDP
        - 只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛的快，不会出现RIP“坏消息传得慢”的问题。而在RIP中，不管网络拓扑是否发生变化，路由器之间都会定期交换路由表信息。
      - OPSF的特点
        - OSPF对不同的链路可根据IP分组的不同服务类型（TOS）而设置成不同的代价。因此，OSPF对于不同类型的业务可计算出不同的路由，十分灵活。
        - 如果到同一目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径。这称为多路径间的负载平衡
        - 所有在OSPF路由器之间交换的分组都具有鉴别功能，因而保证了仅在可信赖的路由器之间交换链路状态信息。
        - 支持可变长的子网划分和无分类编址CIDR
        - 每个链路状态都带上了一个32位的序号，序号越大，状态就越新
      - OSPF的基本工作原理
        - 由于各路由器之间频繁地交换链路状态信息，因此所有路由器都能建立一个链路状态数据库。这个数据库实际上就是全网的拓扑结构图，它在全网范围内是一致的（称为链路转态数据库的同步）。然后，每个路由器根据这个全网拓扑结构图，使用Dijkstra最短路径算法从自己到各目的网络的最优路径，一次构造自己的路由表。此后，当链路状态发生变化时，每个路由器重新计算到各目的网络的最优路径，构造新的路由表。
        - 为使OPSF能够用于规模很大的网络，OSPF将一个自治系统再划分为若干更小的范围，称为区域。
        - 划分区域的好处
          - 将利用洪泛法交换链路状态信息的范围局限于每个区域而非整个自治区域，减少了整个网络上的通信量。
        - 在一个区域内部的路由器只知道本区域的完整网络拓扑，而不知道其他区域的。
        - 这些区域也有层次之分
          - 主干区域：处于上层的域，负责连通其他下层的域，并且还连接其他的自治域。
      - OSPF的五种分组类型：
        - 问候分组，用来发现和维持邻站的可达性
        - 数据库描述分组，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息
        - 链路状态请求分组，向对方请求发送某些链路状态目录的详细信息
        - 链路状态更新分组，用洪泛法对全网更新链路状态
        - 链路状态确认分组，对链路更新分组的确认
    
    - 边际网关协议（BGP）
    
      - BGP是不同自治系统的路由器之间交换路由信息的协议，是一种外部网关协议。
    
      - BGP用于互联网的网关之间
    
      - BGP使用的环境不同的主要原因
    
        - 因特网的规模太大，使得自治系统之间路由选择非常困难
        - 对于自治系统之间的路由选择，要寻找最佳路由是很不现实的。
        - 自治系统之间的路由选择必须考虑有关策略。
    
      - BGP只能力求寻找一条能够到达目的网络且较好的路由，而并非寻找一条最佳路由。
    
      - BGP采用的是路径向量路由选择协议，它与距离向量协议和链路转态协议有很大的区别。
    
      - BGP是应用层协议，它是基于TCP的。
    
      - BGP工作原理
    
        - 每个自治系统的管理员要选择至少一个路由器（可以有多个）作为该自治系统的“BGP发言人”。
        - 一个BGP发言人与其他自治系统中的BGP发言人要交换路由信息，就要先建立TCP连接（可见BGP报文是通过TCP传送的，也就是说BGP报文是TCP报文的数据部分），然后在此连接上交换BGP报文以建立BGP会话，再利用BGP会话交换路由信息。
        - 当所有BGP发言人都相互交换网络可达性的信息后，各BGP发言人就可找出到达各个自治系统的较好路由。
        - 每个BGP发言人除必须运行BGP外，还必须运行该AS所用的内部网关协议。
        - BGP所交换的网络可达性信息就是要到达某个网络所要经过的一系列AS。
    
      - BGP的特点
    
        - BGP交换路由信息的结点数量级是自治系统的数量级，比这些自治系统中的网络数少很多。
        - 每个自治系统中BGP发言人（或边界路由器）的数目是很少的。这样就使得自治系统之间的额路由选择不致过分复杂。
        - BGP支持CIDR，因此BGP的路由表也就应当包括目的网路前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列。
        - 在BGP刚运行时，BGP的邻站交换整个BGP路由表，但以后只需要在发生变化时更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处
    
      - BGP-4使用4中报文
    
        - 打开（Open）报文。用来与相邻的另一个BGP发言人建立关系。
        - 更新（Update）报文。用来发送某一路由的信息，以及列出要撤销的多条路由。
        - 保活（Keepalive）报文。用来确认打开报文并周期性地证实邻站关系
        - 通知（Notification）报文。用来发送检测到的差错。
    
      - 三种路由协议的比较
    
        - | 协议     | RIP                                      | OSPF                                 | BGP                                      |
          | -------- | ---------------------------------------- | ------------------------------------ | ---------------------------------------- |
          | 类型     | 内部                                     | 内部                                 | 外部                                     |
          | 路由算法 | 距离—向量                                | 链路状态                             | 路径—向量                                |
          | 传递协议 | UDP                                      | IP                                   | TCP                                      |
          | 路径选择 | 跳数最少                                 | 代价最低                             | 较好、非最佳                             |
          | 交换节点 | 和本结点相邻的路由器                     | 网络中的所有路由器                   | 和本结点相邻的路由器                     |
          | 交换内容 | 当前路由器知道的全部信息，即自己的路由表 | 与本路由器相邻的所有路由器的链路状态 | 首次：整个路由表<br>非首次：有变化的部分 |
    
  - IP组播
    - 组播的概念
    - IP组播地址
    - IGMP与组播路由算法
    
  - 移动IP
    - 移动IP的概念
    - 移动IP通信过程
    
  - 网络层设备
    - 冲突域和广播域
      - 冲突域：指连接到同一物理介质上的所有结点的集合，这些结点之间存在介质争用的现象。
      - 广播域：指接收同样广播消息的结点集合。
      - 物理层为冲突域，链路层和网络层划分冲突域
      - 链路层为广播域，网络层划分广播域
    - 路由器的组成和功能
      - 路由器是一种具有多个输入/输出端口的专用计算机，其任务是连接不同的网络（连接异构网络）并完成路由转发。
      - 直接交付：源主机和目的主机在同一网络上，即源主机和目的之间不需要通过路由器可以直接进行报文传送。
      - 间接交付：源主机和目的主机在不同的网络上，需要通过路由器来间接进行分组传送
      - 路由器可以连接不同的LAN，连接不同的VLAN，连接不同的WAN，或者把LAN和WAN互连起来。
      - 路由器隔离广播域
      - 路由器的组成
        - 从结构上看
          - 路由选择（控制部分）
            - 核心部件：路由选择处理机
              - 路由处理机的任务：根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断更新和维护路由表
          - 分组转发
            - 分组交换的三个组成部分
              - 交换结构
                - 是路由器的关键部件，它根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输入端口转发出去。
                - 常见的三种交换方法
                  - 通过存储器进行交换
                  - 通过总线进行交换
                  - 通过互联网络进行交换
                - 交换结构本身就是一个网络
              - 一组输入端口
                - 输入端口在从物理层接收到的比特流中提取出数据链路层帧，进而从帧中提取出网络层数据报。
              - 一组输出端口
                - 输出端口在网络接收到的IP数据报进行封装生成链路层帧，进而将帧以比特流的形式进行传输。
        - 从模型角度看
          - 网络层设备：实现了网络模型的下三层
      - 路由器的功能
        - 分组转发
          - 通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管理和任务调度
        - 路由计算
          - 通过和其他路由器进行基于路由协议的交互，完成路由表的计算
      - 路由器和网桥的重要区别
        - 网桥与高层协议无关，而路由器是面向协议的，它依据网络地址进行操作，并进行路径选择、分段、帧格式转换、对数据报的生存时间和流量控制等。
    
    - 路由表与路由转发
      - 标准路由表的四个项目
        - 目的网络IP地址
        - 子网掩码
        - 下一跳IP地址
        - 接口
      - 转发表
        - 转发表是从路由表得出的，其表项和路由表项有直接对应关系。
        - 转发表的格式和路由表的各式不同，其结构应使查找最优化（而路由表则需对网络拓扑变化的计算最优化）。
        - 转发表中含有一个分组将要发往的目的地址，以及分组的下一跳（即下一步接收者的目的地址，实际为MAC地址）
        - 为了减少转发表的重复项目，可以使用一个默认路由代替所有具有相同“下一跳”的项目，并将默认路由设置得比其他项目的优先级低。
        - 路由表总是用软件来实现的；转发表可以用软件实现，甚至也可以用特殊的硬件来实现。

{% endmarkmap  %}